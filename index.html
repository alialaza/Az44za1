<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Az44za Pro - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --bg: #000; --card: #111; --primary: #007bff; --text: #fff; --danger: #e74c3c; --success: #2ecc71; }
        body { background: var(--bg); color: var(--text); font-family: 'Cairo', sans-serif; margin: 0; padding: 15px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 1px solid #222; padding-bottom: 10px; }
        .main-btn { background: var(--card); border: 1px solid var(--primary); border-radius: 15px; padding: 20px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .page { display: none; } .active { display: block; }
        .btn { background: var(--primary); color: #fff; border: none; padding: 15px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; font-family: 'Cairo'; }
        input { background: #1a1a1a; border: 1px solid #333; color: #fff; padding: 15px; width: 100%; border-radius: 10px; margin-bottom: 10px; box-sizing: border-box; }
        .card { background: var(--card); border: 1px solid #222; border-radius: 12px; padding: 15px; margin-bottom: 10px; }
        .filter-btns { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; margin-bottom: 15px; }
        .filter-btns button { background: #222; color: #fff; border: 1px solid #444; padding: 8px; border-radius: 8px; font-size: 12px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="main" class="page active">
        <div class="header"><h3>Az44za Pro</h3> <i class="fas fa-sync" onclick="location.reload()"></i> </div>
        <div class="main-btn" onclick="showPage('addSale')"> <span>Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ¹ <i class="fas fa-plus-circle"></i></span> </div>
        <div class="main-btn" onclick="showPage('history')"> <span>Ø§Ù„Ø³Ø¬Ù„ ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙƒØ© <i class="fas fa-share-alt"></i></span> </div>
        <div class="main-btn" onclick="showPage('debtsPage')"> <span>Ø§Ù„Ø¯ÙŠÙˆÙ† <i class="fas fa-hand-holding-usd"></i></span> </div>
        <div class="main-btn" onclick="showPage('statsPage')"> <span>Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„ØªØ­ÙƒÙ… <i class="fas fa-chart-bar"></i></span> </div>
    </div>

    <div id="history" class="page card">
        <h3>Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
        <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„ÙŠÙˆØ²Ø±..." onkeyup="renderSales()">
        <button class="btn" style="background:var(--success)" onclick="copySales()">Ù…Ø´Ø§Ø±ÙƒØ© Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ğŸ“¤</button>
        <div id="logList" style="margin-top:15px"></div>
        <button class="btn" style="background:#444" onclick="showPage('main')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="statsPage" class="page card">
        <h3>Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
        <p>Ø­Ø¯Ø¯ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©:</p>
        <div class="filter-btns">
            <button onclick="setPeriod(7)">7 Ø£ÙŠØ§Ù…</button>
            <button onclick="setPeriod(15)">15 ÙŠÙˆÙ…</button>
            <button onclick="setPeriod(30)">30 ÙŠÙˆÙ…</button>
        </div>
        <input type="date" id="customDate" onchange="calculateByDate(this.value)">
        <div class="card" style="text-align:center; border-color:var(--success)">
            <p id="periodLabel">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù†Ù‚Ø§Ø· Ø§Ù„ÙØªØ±Ø©:</p>
            <h2 id="totalPoints" style="color:var(--success)">0 Ù†Ù‚Ø·Ø©</h2>
        </div>
        <button class="btn" style="background:var(--danger); margin-top:20px" onclick="clearAll()">âš ï¸ Ø­Ø°Ù ÙˆØªØµÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <button class="btn" style="background:#444" onclick="showPage('main')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="debtsPage" class="page card">
        <h3>Ø§Ù„Ø¯ÙŠÙˆÙ†</h3>
        <input id="dn" placeholder="Ø§Ù„Ø§Ø³Ù…">
        <input id="da" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
        <div style="display:flex; gap:5px">
            <button class="btn" style="background:var(--danger)" onclick="saveDebt('Ø·Ù„Ø¨')">Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ†</button>
            <button class="btn" style="background:var(--success)" onclick="saveDebt('ØªØ³Ø¯ÙŠØ¯')">ØªØ³Ø¯ÙŠØ¯</button>
        </div>
        <div id="debtList" style="margin-top:15px"></div>
        <button class="btn" style="background:#444" onclick="showPage('main')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="addSale" class="page card">
        <h3>Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ¹</h3>
        <input id="un" placeholder="Ø§Ù„ÙŠÙˆØ²Ø±">
        <input id="pt" type="number" placeholder="Ø§Ù„Ù†Ù‚Ø§Ø·">
        <button class="btn" onclick="saveSale()">Ø­ÙØ¸</button>
        <button class="btn" style="background:#444" onclick="showPage('main')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAv3xsfgv6zzlBjrhy8Ji1Dj03SE1buqB0",
            authDomain: "az44-2cc0a.firebaseapp.com",
            projectId: "az44-2cc0a",
            storageBucket: "az44-2cc0a.firebasestorage.app",
            messagingSenderId: "404629280954",
            appId: "1:404629280954:web:090ca5748acb24468b8a83"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let sales = [];

        function showPage(p) { 
            document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active'));
            document.getElementById(p).classList.add('active');
        }

        async function saveSale() {
            const u = document.getElementById('un').value; const p = document.getElementById('pt').value;
            if(!u || !p) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            await db.collection("sales").add({ u, p: parseInt(p), t: Date.now(), d: new Date().toISOString().split('T')[0] });
            alert("ØªÙ… âœ…"); showPage('main');
        }

        db.collection("sales").orderBy("t", "desc").onSnapshot(s => {
            sales = []; s.forEach(doc => sales.push(doc.data()));
            renderSales();
        });

        function renderSales() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const filtered = sales.filter(x => x.u.toLowerCase().includes(search));
            document.getElementById('logList').innerHTML = filtered.map(x => `
                <div class="card" style="border-right:3px solid var(--primary)"><b>${x.u}</b>: ${x.p} Ù†Ù‚Ø·Ø© <br><small>${x.d}</small></div>
            `).join('');
        }

        function copySales() {
            const txt = sales.map(x => `${x.u}: ${x.p} (${x.d})`).join('\n');
            navigator.clipboard.writeText(txt).then(() => alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­ ğŸ“‹"));
        }

        function setPeriod(days) {
            const now = Date.now();
            const limit = now - (days * 24 * 60 * 60 * 1000);
            const total = sales.filter(x => x.t >= limit).reduce((acc, curr) => acc + curr.p, 0);
            document.getElementById('periodLabel').innerText = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¢Ø®Ø± ${days} ÙŠÙˆÙ…:`;
            document.getElementById('totalPoints').innerText = total + " Ù†Ù‚Ø·Ø©";
        }

        function calculateByDate(date) {
            const total = sales.filter(x => x.d === date).reduce((acc, curr) => acc + curr.p, 0);
            document.getElementById('periodLabel').innerText = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙŠÙˆÙ… ${date}:`;
            document.getElementById('totalPoints').innerText = total + " Ù†Ù‚Ø·Ø©";
        }

        async function clearAll() {
            if(confirm("Ø³ÙŠØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø´ÙŠØ¡! Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) {
                const s = await db.collection("sales").get(); s.forEach(d => d.ref.delete());
                alert("ØªÙ… Ø§Ù„ØªØµÙÙŠØ±"); location.reload();
            }
        }
    </script>
</body>
</html>
